from models import User
from telegram import KeyboardButton, ReplyKeyboardMarkup
from datetime import datetime

def generate_cabinet_message(user, telegram_id, db):
    message_text = f"üë§ –í–∞—à Telegram ID: {telegram_id}\n"

    if user.is_unlimited:
        message_text += "‚úÖ –£ –≤–∞—Å –±–µ–∑–ª–∏–º–∏—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –±–æ—Ç—É\n"
    elif user.has_paid and user.subscription_expires_at:
        days_left = (user.subscription_expires_at - datetime.utcnow()).days
        message_text += f"üìÖ –ü–æ–¥–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω–∞ –¥–æ {user.subscription_expires_at.strftime('%d.%m.%Y')} ({days_left} –¥–Ω–µ–π –æ—Å—Ç–∞–ª–æ—Å—å)\n"
    else:
        message_text += f"üí¨ –°–æ–æ–±—â–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: {user.free_messages_used} –∏–∑ 50\n"
        message_text += "‚è≥ –ü—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥: –∞–∫—Ç–∏–≤–µ–Ω\n"

    return message_text, ReplyKeyboardMarkup([
        [KeyboardButton("ü§ù –ü–∞—Ä—Ç–Ω—ë—Ä—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞")]
    ], resize_keyboard=True)


def generate_withdraw_info(user):
    return (
        f"üîó <b>–í–∞—à–∞ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞:</b>\n"
        f"https://t.me/EmpathAIChat_bot?start=ref{user.telegram_id}\n\n"
        f"ü§ù <b>–ü—Ä–∏–≥–ª–∞—à–∞–π—Ç–µ ‚Äî –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ!</b>\n"
        f"üí∏ –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ <b>30% –æ—Ç –∫–∞–∂–¥–æ–π –æ–ø–ª–∞—á–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–∏</b> –ø–æ –≤–∞—à–µ–π —Å—Å—ã–ª–∫–µ.\n\n"
        f"üìä <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</b>\n"
        f"üë• –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ: –ø–æ–∫–∞ –Ω–∏–∫–æ–≥–æ\n"
        f"üí∞ –ë–∞–ª–∞–Ω—Å: 0 ‚ÇΩ\n"
        f"üìà –í—Å–µ–≥–æ –∑–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: 0 ‚ÇΩ\n"
        f"üí≥ –í—ã–ø–ª–∞—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Ä—É–±–ª—è—Ö\n"
        f"üìâ <b>–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –≤—ã–≤–æ–¥–∞: 5 000 ‚ÇΩ</b>\n\n"
        f"üßæ <b>–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –≤—ã–ø–ª–∞—Ç—É?</b>\n"
        f"–ù–∞–ø–∏—à–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É: <b>empathpay@bk.ru</b>\n"
        f"–£–∫–∞–∂–∏—Ç–µ:\n"
        f"‚Ä¢ –í–∞—à Telegram ID: {user.telegram_id}\n"
        f"‚Ä¢ –°—É–º–º—É –≤—ã–≤–æ–¥–∞ (–æ—Ç 5 000 ‚ÇΩ)\n"
        f"‚Ä¢ –ù–æ–º–µ—Ä –±–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç—ã\n"
        f"‚Ä¢ –§–ò–û –ø–æ–ª—É—á–∞—Ç–µ–ª—è\n"
        f"‚Ä¢ –°—Ç—Ä–∞–Ω—É –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è\n\n"
        f"üë§ –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –ø–µ—Ä–µ–≤–æ–¥–∞."
    )

    return message_text, ReplyKeyboardMarkup([
        [KeyboardButton("üë§ –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç")]
    ], resize_keyboard=True)
